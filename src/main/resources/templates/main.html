<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Taipei MRT Info Tool</title>
    <link rel="icon" type="image/png" th:href="@{/image/favicon1.ico}" />
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
            crossorigin="anonymous"
    />
    <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"
    ></script>
    <!--    <script src="https://code.jquery.com/jquery-.2.1.slim.min.js"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.datatables.net/v/dt/dt-1.13.8/datatables.min.css" rel="stylesheet">
    <script src="https://cdn.datatables.net/v/dt/dt-1.13.8/datatables.min.js"></script>
    <style>
        .btn-blue,
        .btn-blue:hover,
        .btn-blue:active,
        .btn-blue:visited {
          background-color: #89CFF0 !important;
        }

        .btn-brown,
        .btn-brown:hover,
        .btn-brown:active,
        .btn-brown:visited {
          background-color: #e1c16e !important;
        }

        .btn-pink,
        .btn-pink:hover,
        .btn-pink:active,
        .btn-pink:visited {
          background-color: #f2d2bd !important;
        }

        .btn-orange,
        .btn-orange:hover,
        .btn-orange:active,
        .btn-orange:visited {
          background-color: #ffa500 !important;
        }

        .btn-yellow,
        .btn-yellow:hover,
        .btn-yellow:active,
        .btn-yellow:visited {
          background-color: #FFFF00 !important;
        }

        .btn-lime,
        .btn-lime:hover,
        .btn-lime:active,
        .btn-lime:visited {
          background-color: #C3D825 !important;
        }


      #fixedbutton {
          position: fixed;
          bottom: 0px;
          right: 0px;
      }

      .card-img-top
      {
        height: 100px;
        width: 100px;
      }

       .rotated {
            -webkit-transform: rotate(360deg);  /* Chrome, Safari 3.1+ */
            -moz-transform: rotate(360deg);  /* Firefox 3.5-15 */
            -ms-transform: rotate(360deg);  /* IE 9 */
            -o-transform: rotate(360deg);  /* Opera 10.50-12.00 */
            transform: rotate(360deg);  /* Firefox 16+, IE 10+, Opera 12.10+ */
       }

        .duration-2 {
             transition-duration: 1.3s;
         }

        footer1 {
          position: absolute;
          bottom: 0;
          width: 100%;
<!--          background-color: #333;-->
<!--          color:#fff;-->
        }



    </style>
</head>
<body>
<div class="container">
    <div class="row mt-5">
        <div class="col-12 d-flex bg-light" style="height: 120px;">
            <div class="d-flex mx-auto align-items-center ">
                <img src="image/subway.png" class="card-img-top d-inline duration-2" id="subway" alt="...">
                <h3 class="text-center ms-3"><b>捷運 Information Box</b></h3>
            </div>

            <!--            <div class="card" style="width: 18rem;">-->
            <!--               -->
            <!--            </div>-->
            <!--            <div class="d-flex d-inline justify-content-center mt-3">-->
            <!--                <h3>台北捷運 各項功能查詢</h3>-->
            <!--            </div>-->
        </div>
<!--                <div class="col-12 ">-->
<!--                    <div class="mb-3 mt-3" style="width: 18rem;" >-->
<!--                        &lt;!&ndash; <label for="formFile" class="form-label">上傳捷運資料檔</label> &ndash;&gt;-->
<!--                        <input class="form-control" type="file" id="formFile">-->
<!--                    </div>-->

<!--                    <div class="card mt-3" style="width: 18rem;" id="upload">-->
<!--                        <div class="card-body">-->
<!--                            <h5 class="card-title">上傳捷運資料檔</h5>-->
<!--                            <h6 class="card-subtitle mb-2 text-body-secondary">-->

<!--                            </h6>-->

<!--                            &lt;!&ndash;                        <p class="card-text"></p>&ndash;&gt;-->
<!--                            &lt;!&ndash; <a href="#" class="card-link">前往功能</a> &ndash;&gt;-->
<!--                            &lt;!&ndash;                        <a href="#" class="card-link">Another link</a>&ndash;&gt;-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->


        <div class="col-12 mt-3">
            <h5>請選取捷運站</h5>
            <button id="btn1" value="blue" type="button" class="btn btn-outline-secondary">
                板南線
            </button>
            <button id="btn2" value="brown" type="button" class="btn btn-outline-secondary">
                文湖線
            </button>
            <button id="btn3" value="green" type="button" class="btn btn-outline-secondary">
                松山新店線
            </button>
            <button id="btn4" value="red" type="button" class="btn btn-outline-secondary">
                淡水信義線
            </button>
            <button id="btn5" value="orange" type="button" class="btn btn-outline-secondary">
                中和新蘆線
            </button>
<!--            <button id="btn6" value="yellow" type="button" class="btn btn-outline-secondary">-->
<!--                環狀線-->
<!--            </button>-->
        </div>


        <div class="col-12 mt-4">
            <h5>您選擇的捷運站為 : <span id="choice"></span><span id="choiceEn"></span></h5>
            <div class="mt-2">
                <button class="btn btn-blue" id="query-submit">送出</button>
            </div>
        </div>
        <div class="col-12 d-inline-block">
            <div class="col mt-4 d-none main-btn" id="blue"></div>
            <div class="col mt-4 d-none main-btn" id="brown"></div>
            <div class="col mt-4 d-none main-btn" id="green"></div>
            <div class="col mt-4 d-none main-btn" id="red"></div>
            <div class="col mt-4 d-none main-btn" id="orange"></div>
            <div class="col mt-4 d-none main-btn" id="yellow"></div>
        </div>


        <div class="col-3 mt-4 d-flex align-items-stretch info d-none">
            <div class="card" style="width: 18rem;">
                <img src="image/escalator.jpg" class="card-img-top mx-auto d-block" alt="...">
                <div class="card-body">
                    <h4 class="card-title text-center"><b>電扶梯</b></h4>
                    <h6 class="mt-2">往上電扶梯：<span id="upEscalator"></span></h6>
                    <h6>往下電扶梯：<span id="downEscalator"></span></h6>
                    <h6>雙向電扶梯：<span id="bothDirectionsEscalator"></span></h6>
                </div>
            </div>
        </div>
        <div class="col-3 mt-4 d-flex align-items-stretch info d-none">
            <div class="card" style="width: 18rem;">
                <img src="image/elevator.jpg" class="card-img-top mx-auto d-block" alt="...">
                <div class="card-body">
                    <h4 class="card-title text-center"><b>無障礙電梯</b></h4>
                    <h6 class="mt-2"><span id="elevator"></span></h6>

                </div>
            </div>
        </div>
        <div class="col-3 mt-4 d-flex align-items-stretch info d-none">
            <div class="card" style="width: 18rem;">
                <img src="image/toilet.png" class="card-img-top mx-auto d-block" alt="...">
                <div class="card-body">
                    <h4 class="card-title text-center"><b>廁所</b></h4>
                    <h6 class="mt-2">站內廁所：<span id="paidWC"></span></h6>
                    <h6>站外廁所：<span id="freeWClocate"></span></h6>
                </div>
            </div>
        </div>

        <div class="col-3 mt-4 d-flex align-items-stretch info d-none">
            <div class="card" style="width: 18rem;">
                <img src="image/bike.png" class="card-img-top mx-auto d-block" alt="...">
                <div class="card-body">
                    <h4 class="card-title text-center"><b>自行車/Youbike</b></h4>
                    <h6 class="mt-2">是否開放自行車：<span id="allowBike"></span></h6>
                    <h6>Youbike：</h6>
                </div>
            </div>
        </div>

        <div class="col-12 mt-3 info d-none">
            <h5>備註：<span id="note"></span></h5>
        </div>
    </div>

    <footer class="footer fixed-bottom ">
        <div class="container-fluid">
            <div class="d-flex justify-content-between border-top h-200 ">
                <span class="small mt-3 mb-3 mx-auto">Jean Chen &copy; All Rights Reserved.</span>
            </div>
        </div>
    </footer>

</div>

<script>
    $("#upload").on("click",function(){
      if ($('#formFile').get(0).files.length === 0) {
                Swal.fire({
                    title: '請選擇檔案',
                    icon: 'error'
                });
                return;
            }

      let item = $('#formFile').get(0).files[0];
      let data = new FormData();
      data.append('files', item);

      $.ajax({
                url: "/stations/upload",
                type : "POST",
                data : data,
                enctype: "multipart/form-data",
                contentType: false,
                cache: false,
                processData: false,
                beforeSend: function (xhr) {

                    xhr.setRequestHeader("Authorization", 'Bearer ' + $('meta[name=token]').attr("content"));
                },
                success : function (response) {
                    Swal.fire({
                        icon: "success",
                        title: "MRT Data uploads successfully!"
                    });
                },
                error: function (response) {
                    Swal.fire({
                        title: '上傳失敗',
                        // html: '<b>' + translateHttpStatus(response) + '</b>' + '<br>' + getResponseMessage(response),
                        icon: 'error'
                    });
                },
                complete: function (response) {
                    // completeLoading();
                }
            });


    })

    function addButtons(data,lineColor){
      let btnKind = "";
      switch(lineColor) {
        case "green":
          btnKind = "success";
          break;
        case "blue":
          btnKind = "primary";
          break;
        case "red":
          btnKind = "danger";
          break;
        case "brown":
          btnKind = "brown";
          break;
        case "orange":
          btnKind = "orange";
          break;
        case "yellow":
          btnKind = "yellow";
          break;
      }

      // let btnBlockId =

      let btnBlock = $(`#${lineColor}`);


      $.each(data, function(key, value) {
<!--        let showText = `${value.stationName} ${value.stationNameEn}`;-->
        let addedBtn = `<button type='button' class='btn btn-${btnKind} ms-2 mt-2 idv'>${value.stationName}</button>`;
<!--        let addedBtn = `<button type='button' class='btn btn-${btnKind} ms-2 mt-2 idv'>${showText}</button>`;-->
        btnBlock.append(addedBtn);
      });
    }

    function checkBtnBlock(lineColor){
         var hidden = $(`#${lineColor}`).hasClass("d-none");

         $("#blue,#brown,#red,#orange,#yellow").addClass("d-none");

         if (hidden) {
          $(`#${lineColor}`).removeClass('d-none');
         } else {
          $(`#${lineColor}`).addClass('d-none');
      }
    }



    $("#btn1,#btn2,#btn3,#btn4,#btn5,#btn6").on("click",function(){
        let lineColor = $(this).val();
<!--        console.log("which line:" + lineColor);-->

        $(".main-btn").children("button").remove();

        var hidden = $(".info").hasClass("d-none");

        if(!hidden){
            $(".info").addClass("d-none");
        }

        $.ajax({
            type:"GET",
            url:"/stations/" + lineColor,
            dataType:"json",
            success:function(data){
              addButtons(data,lineColor);
        }

      });

    });


    $('#btn1').on('click', function () {
      var hidden = $('#blue').hasClass('d-none')
      $('#brown,#green,#red,#orange,#yellow').addClass('d-none');
      if (hidden) {
        $('#blue').removeClass('d-none')
      } else {
        $('#blue').addClass('d-none')
      }
    })

    $('#btn2').on('click', function () {
      var hidden = $('#brown').hasClass('d-none')

      $('#blue,#green,#red,#orange,#yellow').addClass('d-none');

      if (hidden) {
        $('#brown').removeClass('d-none')
      } else {
        $('#brown').addClass('d-none')
      }
    })

    $('#btn3').on('click', function () {
      var hidden = $('#green').hasClass('d-none')
      $('#blue,#brown,#red,#orange,#yellow').addClass('d-none');

      if (hidden) {
        $('#green').removeClass('d-none');
      } else {
        $('#green').addClass('d-none');
      }
    })

    $('#btn4').on('click', function () {
      var hidden = $('#red').hasClass('d-none')
      $('#blue,#brown,#green,#orange,#yellow').addClass('d-none');
      if (hidden) {
        $('#red').removeClass('d-none')
      } else {
        $('#red').addClass('d-none')
      }
    })

    $('#btn5').on('click', function () {
      var hidden = $('#orange').hasClass('d-none')
      $('#blue,#brown,#green,#red,#yellow').addClass('d-none');
      if (hidden) {
        $('#orange').removeClass('d-none')
      } else {
        $('#orange').addClass('d-none')
      }
    })

    $('#btn6').on('click', function () {
      var hidden = $('#yellow').hasClass('d-none')
      $('#blue,#brown,#green,#red,#orange').addClass('d-none');
      if (hidden) {
        $('#yellow').removeClass('d-none')
      } else {
        $('#yellow').addClass('d-none')
      }
    })

  //   $('#escalator,#elevator,#youbike').on('click', function () {
  //     $(this).css('background-color', '#A3D1D1')
  //   })


       $("button:button.idv")
        .live("click",function(){
          var text = $(this).text();
          $("#choice").html("<b>"+text+"</b>");

        });


    function makeImageRotate(){
        let rotateBox = 0;
         $('#subway').animate(
                {
                  duration: 5000,
                  step: function(now) {
                   rotateBox += 180
<!--                     if (rotate === 360) {-->
<!--                        rotate = 0;-->
<!--                     }-->

<!--                    $(this).css({ transform: 'rotate(' + rotate + 'deg)' });-->
                    $('#subway').css({ transform: `rotate(${rotateBox}deg)` });
                  }
                }
            );
    }

    $(document).ready(function () {
       $("#query-submit").on("click",function(){
<!--            makeImageRotate();-->

        $('#subway').toggleClass('rotated');

        let stationName = $("#choice").text();
        var hidden = $(".info").hasClass("d-none");
        if(!hidden){
             $(".info").addClass("d-none");
             $('.info').fadeToggle("slow", function() {});
        }
        $.ajax({
            type:"GET",
            url:"/stations/getStationInfo/" + encodeURIComponent(encodeURIComponent(stationName)),
            dataType:"json",
            success:function(data){
                $("#upEscalator").html(data.upEscalator);
                $("#downEscalator").html(data.downEscalator);
                $("#bothDirectionsEscalator").html(data.bothDirectionsEscalator);
                $("#elevator").html(data.elevator);
                $("#paidWC").html(data.paidWC);
                $("#freeWClocate").html(data.freeWClocate);
                $("#allowBike").html(data.allowBike ? "開放":"不開放");
                $("#note").html(data.note);

                var hidden = $(".info").hasClass("d-none");
                if(hidden){
                     $(".info").removeClass("d-none");
                     $('.info').slideDown("slow", function() {});
                }
            }

        })
    });
   });




</script>

</body>
</html>
